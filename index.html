<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PAL OS PRO X</title>
<style>
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;height:100vh;overflow:hidden;background:linear-gradient(135deg,#4facfe,#00f2fe);color:white}
#home{display:flex;flex-wrap:wrap;gap:20px;padding:20px;position:absolute;width:100%;height:100%;}
.icon{width:90px;text-align:center;cursor:pointer;transition:.2s}
.icon:hover{transform:scale(1.1)}
.icon-box{width:75px;height:75px;border-radius:20px;display:flex;align-items:center;justify-content:center;font-size:28px;background:rgba(255,255,255,.25);backdrop-filter:blur(10px);box-shadow:0 6px 15px rgba(0,0,0,.3);margin-bottom:6px}
.app{position:absolute;top:0;left:0;width:100%;height:100%;display:none;flex-direction:column;background:rgba(0,0,0,.3);backdrop-filter:blur(25px);padding:15px;box-sizing:border-box}
.header{display:flex;justify-content:space-between;align-items:center;padding:15px;font-size:20px}
button{padding:10px 18px;border-radius:18px;border:none;font-weight:bold;cursor:pointer;position:relative;overflow:hidden;transition:all .2s ease}
button:hover{transform:scale(1.05);box-shadow:0 6px 15px rgba(0,0,0,.3)}
button:active{transform:scale(0.97)}
button::after{content:"";position:absolute;width:100%;height:100%;top:0;left:0;background:rgba(255,255,255,.3);border-radius:18px;transform:scale(0);opacity:0;transition:transform .3s,opacity .3s}
button:focus::after,button:active::after{transform:scale(1.5);opacity:1;transition:transform .15s,opacity .15s}
.chat-box,#notesList,#galleryContainer,#musicList{flex:1;padding:12px;overflow-y:auto;display:flex;flex-direction:column}
.message{margin:6px 0;padding:10px 14px;border-radius:18px;max-width:75%}
.message.user{background:rgba(255,255,255,.5);align-self:flex-end}
.message.pal{background:rgba(0,0,0,.25);color:white;align-self:flex-start}
video{width:100%;height:auto;border-radius:18px;max-height:60vh;object-fit:cover}
canvas{width:100%;border-radius:18px}
input,select,textarea{padding:12px 14px;font-size:18px;border-radius:14px;width:100%;box-sizing:border-box}
#updateOverlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.75);color:white;display:flex;align-items:center;justify-content:center;font-size:26px;z-index:9999;display:none}
</style>
</head>
<body>

<div id="updateOverlay">Updating PAL...</div>

<div id="home">
<div class="icon" onclick="openApp('chat')"><div class="icon-box">üí¨</div>Chat</div>
<div class="icon" onclick="openApp('music')"><div class="icon-box">üéµ</div>Music</div>
<div class="icon" onclick="openApp('games')"><div class="icon-box">üéÆ</div>Runner</div>
<div class="icon" onclick="openApp('camera')"><div class="icon-box">üì∑</div>Camera</div>
<div class="icon" onclick="openApp('gallery')"><div class="icon-box">üñºÔ∏è</div>Gallery</div>
<div class="icon" onclick="openApp('calculator')"><div class="icon-box">üßÆ</div>Calculator</div>
<div class="icon" onclick="openApp('notes')"><div class="icon-box">üìù</div>Notes</div>
<div class="icon" onclick="openApp('weather')"><div class="icon-box">‚òÄÔ∏è</div>Weather</div>
<div class="icon" onclick="openApp('settings')"><div class="icon-box">‚öôÔ∏è</div>Settings</div>
</div>

<!-- CHAT -->
<div id="chat" class="app">
<div class="header">PAL Chat <button onclick="closeApp()">Home</button></div>
<div id="chatBox" class="chat-box"></div>
<div style="display:flex;gap:10px;padding:10px">
<input id="chatInput" placeholder="Talk to PAL...">
<button onclick="sendMessage()">Send</button>
</div>
</div>

<!-- MUSIC -->
<div id="music" class="app">
<div class="header">Music <button onclick="closeApp()">Home</button></div>
<div class="card">
<audio id="player" controls style="width:100%">
<source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
Your browser does not support audio.
</audio>
<br><br>
<button onclick="addDefaultSongs()">Load Default Songs</button>
<input type="file" accept="audio/*" onchange="loadSong(event)">
<div id="musicList" class="chat-box"></div>
</div>
</div>

<!-- RUNNER GAME -->
<div id="games" class="app">
<div class="header">Endless Runner <button onclick="closeApp()">Home</button></div>
<canvas id="runnerCanvas"></canvas>
</div>

<!-- CAMERA -->
<div id="camera" class="app">
<div class="header">Camera <button onclick="closeApp()">Home</button></div>
<video autoplay playsinline></video>
<button onclick="capturePhoto()">Capture</button>
</div>

<!-- GALLERY -->
<div id="gallery" class="app">
<div class="header">Gallery <button onclick="closeApp()">Home</button></div>
<div id="galleryContainer" class="chat-box"></div>
</div>

<!-- CALCULATOR -->
<div id="calculator" class="app">
<div class="header">Calculator <button onclick="closeApp()">Home</button></div>
<div style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px;padding:10px">
<input id="calcInput" placeholder="0" disabled style="grid-column:span4">
<button onclick="calcPress('7')">7</button>
<button onclick="calcPress('8')">8</button>
<button onclick="calcPress('9')">9</button>
<button onclick="calcPress('/')">/</button>
<button onclick="calcPress('4')">4</button>
<button onclick="calcPress('5')">5</button>
<button onclick="calcPress('6')">6</button>
<button onclick="calcPress('*')">*</button>
<button onclick="calcPress('1')">1</button>
<button onclick="calcPress('2')">2</button>
<button onclick="calcPress('3')">3</button>
<button onclick="calcPress('-')">-</button>
<button onclick="calcPress('0')">0</button>
<button onclick="calcPress('.')">.</button>
<button onclick="calcPress('=')">=</button>
<button onclick="calcPress('+')">+</button>
</div>
</div>

<!-- NOTES -->
<div id="notes" class="app">
<div class="header">Notes <button onclick="closeApp()">Home</button></div>
<div id="notesList" class="chat-box"></div>
<div style="display:flex;gap:10px;padding:10px">
<textarea id="noteInput" placeholder="Write a note..."></textarea>
<button onclick="saveNote()">Save</button>
</div>
</div>

<!-- WEATHER -->
<div id="weather" class="app">
<div class="header">Weather <button onclick="closeApp()">Home</button></div>
<div style="padding:10px">
<input id="cityInput" placeholder="Enter city">
<button onclick="getWeather()">Search</button>
<p id="weatherResult"></p>
</div>
</div>

<!-- SETTINGS -->
<div id="settings" class="app">
<div class="header">Settings <button onclick="closeApp()">Home</button></div>
<div style="padding:10px">
<input type="file" accept="image/*" onchange="changeWallpaper(event)">
<button onclick="simulateUpdate()">Simulate Update</button>
</div>
</div>

<script>
let currentApp=null;
let galleryImages=JSON.parse(localStorage.getItem('gallery'))||[];

function openApp(id){
  document.querySelectorAll('.app').forEach(a=>a.style.display='none');
  document.getElementById('home').style.display='none';
  const app=document.getElementById(id);
  if(app) app.style.display='flex';
  currentApp=id;
  if(id==='camera') startCamera();
  if(id==='gallery') loadGallery();
  if(id==='games') startGame();
}

function closeApp(){
  document.querySelectorAll('.app').forEach(a=>a.style.display='none');
  document.getElementById('home').style.display='flex';
  stopCamera();
}

// CHAT
function sendMessage(){
  const input=document.getElementById('chatInput');
  if(!input.value.trim()) return;
  const box=document.getElementById('chatBox');
  const user=document.createElement('div');
  user.className='message user';
  user.textContent=input.value;
  box.appendChild(user);
  input.value='';
  setTimeout(()=>{
    const pal=document.createElement('div');
    pal.className='message pal';
    pal.textContent='PAL says hi! üòé';
    box.appendChild(pal);
    box.scrollTop=box.scrollHeight;
  },400);
}

// MUSIC
function addDefaultSongs(){
  const player=document.getElementById('player');
  player.src='https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3';
  player.play();
}
function loadSong(e){
  const file=e.target.files[0];
  if(file){
    const player=document.getElementById('player');
    player.src=URL.createObjectURL(file);
    player.play();
  }
}

// CAMERA
async function startCamera(){
  const video=document.querySelector('#camera video');
  try{
    const stream=await navigator.mediaDevices.getUserMedia({video:true});
    video.srcObject=stream;
  }catch(e){alert('Camera not available');}
}
function stopCamera(){
  const video=document.querySelector('#camera video');
  if(video.srcObject){video.srcObject.getTracks().forEach(t=>t.stop());video.srcObject=null;}
}
function capturePhoto(){
  const video=document.querySelector('#camera video');
  const canvas=document.createElement('canvas');
  canvas.width=video.videoWidth;
  canvas.height=video.videoHeight;
  canvas.getContext('2d').drawImage(video,0,0);
  galleryImages.push(canvas.toDataURL());
  localStorage.setItem('gallery',JSON.stringify(galleryImages));
  alert('Photo saved to gallery');
}
function loadGallery(){
  const container=document.getElementById('galleryContainer');
  container.innerHTML='';
  galleryImages.forEach(src=>{
    const img=document.createElement('img');
    img.src=src;
    img.style.width='100%';
    img.style.marginBottom='10px';
    container.appendChild(img);
  });
}

// CALCULATOR
let calcValue='';
function calcPress(val){
  if(val==='='){try{calcValue=eval(calcValue);}catch{calcValue='Error';}
  }else if(val==='C'){calcValue='';}else{calcValue+=val;}
  document.getElementById('calcInput').value=calcValue;
}

// NOTES
function saveNote(){
  const txt=document.getElementById('noteInput').value;
  if(!txt) return;
  const box=document.getElementById('notesList');
  const note=document.createElement('div');
  note.className='message user';
  note.textContent=txt;
  box.appendChild(note);
  document.getElementById('noteInput').value='';
}

// WEATHER
const WEATHER_API_KEY = '8183f11165a1dc83ae95f3479dcaea49'; // Replace with real key
function getWeather(){
  const city=document.getElementById('cityInput').value;
  if(!city) return;
  fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${WEATHER_API_KEY}&units=metric`)
    .then(res=>res.json())
    .then(data=>{
      if(data.main){
        document.getElementById('weatherResult').textContent = `${data.name}: ${data.main.temp}¬∞C, ${data.weather[0].description}`;
      } else {
        document.getElementById('weatherResult').textContent = 'City not found.';
      }
    })
    .catch(()=>{document.getElementById('weatherResult').textContent='Error fetching weather';});
}

// SETTINGS
function changeWallpaper(e){
  const file=e.target.files[0];
  if(!file) return;
  const reader=new FileReader();
  reader.onload=e=>{
    document.body.style.background=`url('${e.target.result}') center/cover no-repeat`;
    localStorage.setItem('wallpaper',e.target.result);
  };
  reader.readAsDataURL(file);
}
window.onload=()=>{
  const saved=localStorage.getItem('wallpaper');
  if(saved) document.body.style.background=`url('${saved}') center/cover no-repeat`;
  setInterval(()=>{
    document.getElementById('updateOverlay').style.display='flex';
    setTimeout(()=>{document.getElementById('updateOverlay').style.display='none';},5000);
  },300000);
}

// RUNNER
const canvas=document.getElementById('runnerCanvas');
const ctx=canvas.getContext('2d');
let player, obstacles, gameInterval;
function startGame(){
  canvas.width=window.innerWidth;
  canvas.height=window.innerHeight-60;
  player={x:50,y:canvas.height-60,w:40,h:40,vy:0,jumping:false};
  obstacles=[];
  clearInterval(gameInterval);
  gameInterval=setInterval(updateGame,20);

  // Jump support
  canvas.onclick=()=>jump();
  document.onkeydown=(e)=>{if(e.code==='Space') jump();};
}
function jump(){
  if(player && !player.jumping){player.vy=-15;player.jumping=true;}
}
function updateGame(){
  if(!player) return;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  player.vy+=1;player.y+=player.vy;
  if(player.y>canvas.height-60){player.y=canvas.height-60;player.vy=0;player.jumping=false;}
  ctx.fillStyle='lime';ctx.fillRect(player.x,player.y,player.w,player.h);
  if(Math.random()<0.02)obstacles.push({x:canvas.width,y:canvas.height-40,w:20,h:40});
  obstacles.forEach(o=>{o.x-=6;ctx.fillStyle='red';ctx.fillRect(o.x,o.y,o.w,o.h);if(o.x<player.x+player.w&&o.x+o.w>player.x&&o.y<player.y+player.h&&o.y+o.h>player.y){clearInterval(gameInterval);alert('Game Over')}});
  obstacles=obstacles.filter(o=>o.x>-20);
}
</script>

</body>
</html>
